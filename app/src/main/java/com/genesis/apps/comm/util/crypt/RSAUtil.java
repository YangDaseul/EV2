package com.genesis.apps.comm.util.crypt;

import org.spongycastle.asn1.ASN1ObjectIdentifier;
import org.spongycastle.asn1.pkcs.PKCSObjectIdentifiers;
import org.spongycastle.asn1.x509.X509ObjectIdentifiers;
import org.spongycastle.crypto.params.RSAKeyParameters;
import org.spongycastle.crypto.params.RSAPrivateCrtKeyParameters;
import org.spongycastle.jce.provider.BouncyCastleProvider;
import org.spongycastle.util.Arrays;
import org.spongycastle.util.Fingerprint;

import java.math.BigInteger;
import java.security.KeyFactory;
import java.security.Security;
import java.security.Signature;
import java.security.interfaces.RSAPrivateCrtKey;
import java.security.interfaces.RSAPrivateKey;
import java.security.interfaces.RSAPublicKey;
import java.security.spec.PKCS8EncodedKeySpec;
import java.security.spec.RSAPublicKeySpec;


public class RSAUtil {
	static {
		Security.insertProviderAt(new BouncyCastleProvider(), 1);
	}
	public static final ASN1ObjectIdentifier[] rsaOids = { PKCSObjectIdentifiers.rsaEncryption,
			X509ObjectIdentifiers.id_ea_rsa, PKCSObjectIdentifiers.id_RSAES_OAEP, PKCSObjectIdentifiers.id_RSASSA_PSS };

	public static boolean isRsaOid(ASN1ObjectIdentifier algOid) {
		for (int i = 0; i != rsaOids.length; i++) {
			if (algOid.equals(rsaOids[i])) {
				return true;
			}
		}

		return false;
	}

	static RSAKeyParameters generatePublicKeyParameter(RSAPublicKey key) {
		return new RSAKeyParameters(false, key.getModulus(), key.getPublicExponent());

	}

	static RSAKeyParameters generatePrivateKeyParameter(RSAPrivateKey key) {
		if (key instanceof RSAPrivateCrtKey) {
			RSAPrivateCrtKey k = (RSAPrivateCrtKey) key;

			return new RSAPrivateCrtKeyParameters(k.getModulus(), k.getPublicExponent(), k.getPrivateExponent(),
					k.getPrimeP(), k.getPrimeQ(), k.getPrimeExponentP(), k.getPrimeExponentQ(), k.getCrtCoefficient());
		} else {
			RSAPrivateKey k = key;

			return new RSAKeyParameters(true, k.getModulus(), k.getPrivateExponent());
		}
	}

	static String generateKeyFingerprint(BigInteger modulus, BigInteger publicExponent) {
		return new Fingerprint(Arrays.concatenate(modulus.toByteArray(), publicExponent.toByteArray())).toString();
	}

	public static RSAPublicKey getRsaRootPublicKey() throws Exception {

		KeyFactory kf = KeyFactory.getInstance("RSA", "BC");
//        CertParser parser = new CertParser();
//        MyRootRsaCert rootCert = parser
//                .getRootRsaCert(HexStringConverter.stringToHex(certData.getProperty("root.rsa.cert")));
//        rootCert.m = rootCert.m[0] < 0 ? (ByteUtils.append(new byte[]{0x00}, rootCert.m)) : rootCert.m;

		RSAPublicKeySpec pubKeySpec = new RSAPublicKeySpec(new BigInteger("00AA7BB3D5EB76125BDD659031753505A4C157D6A5D676E8D51D0A0814B73197934DEF1CE89EF0077238437FBCE1C4E8CDC019D73946B3055F39BDFBFF1F694A674F3A98CD6284CDEAA848D13A76D4301FA654783381361FC6171F54D5F1A0CCB06939247A9D8BC176AC99D416528E8BB1E7A1D362A765C074A37DFB03B8B479AEC449B6F54537212C403F602C77094D3411D57B37FE6BB97CB44FD8D3DE9B8236F2E83476DDCEC85604A623132F50CC753C9EE3C6CE27A6AC3831EBCAFCED8EEA9A37457FB9DB109AAB47956DE9F4314807258B71B391B66B4805F8BB858039C51A99359DF2041917F1B30490BFA6320F5E85A68FDE8649C160E343F5D0340CB1", 16),
				new BigInteger("010001", 16));

		return (RSAPublicKey) kf.generatePublic(pubKeySpec);
	}

	public static RSAPrivateKey getRsaRootPrivateKey() throws Exception {

		KeyFactory kf = KeyFactory.getInstance("RSA", "BC");
		PKCS8EncodedKeySpec pkcsKeySpec = new PKCS8EncodedKeySpec(
				HexStringConverter.stringToHex("308204BD020100300D06092A864886F70D0101010500048204A7308204A30201000282010100AA7BB3D5EB76125BDD659031753505A4C157D6A5D676E8D51D0A0814B73197934DEF1CE89EF0077238437FBCE1C4E8CDC019D73946B3055F39BDFBFF1F694A674F3A98CD6284CDEAA848D13A76D4301FA654783381361FC6171F54D5F1A0CCB06939247A9D8BC176AC99D416528E8BB1E7A1D362A765C074A37DFB03B8B479AEC449B6F54537212C403F602C77094D3411D57B37FE6BB97CB44FD8D3DE9B8236F2E83476DDCEC85604A623132F50CC753C9EE3C6CE27A6AC3831EBCAFCED8EEA9A37457FB9DB109AAB47956DE9F4314807258B71B391B66B4805F8BB858039C51A99359DF2041917F1B30490BFA6320F5E85A68FDE8649C160E343F5D0340CB10203010001028201001978E225D4488FF5A9DEC2ECA0D68B4152A20D303A1B0A2ECD67F24D261202D3BF913A80873ED5DDFB0A1ACBDDEFCDD8F01AEC4D6282DD0A9D560590D8E0A27D4D19343B7BBCDC07739D6DA58E9BA595150509F0A81DAE21AAD2C39A33C012D548E380CFD13A506DAADC511404C1C79D8D3E60971CEBD7159657FC6951EFA53E7921603D99BF56447D1CF23AE57783ADBEE1DFC1A202E6C4347190B64E7A99B3BA7A699E4368F36BB3A163EADEBBD94DFF6B19787A9FDAA41AE7175F3063C46EFF3FD7B6FA3051C8A0A2B70A624E58DF9B83996D1E74C02C4ADD83C97DA3A249AFE41555B558C47F26251DF33585B5EAE0FF6972A1C75A9144B9A986AE959C0102818100D6F374BDF3CEDF358A0564CD32FBC8E078FE897F96BC5C75F2905478BEF123B188CFE2043D6A20C263624973D06A602748B7FF96B7C466ACBCEADB9ABDB690380254793FBB927BBF2F0C83E6016A1F346AEDBEE68DCD592216265A30C9B8FB1E7996872986F53668060E97AA3978E7542E57B6C38587E15811897CFF2CA9686502818100CB0A4D1E608BD015FEF9299935596894C8F442C76AE9B22C8774168E2D721A61BFE52EAA56956ACD2BCC6FE3E71727721DE9964A55554EF40AE15B518210CDAF268E898FD6C5C237DDD109A8B5B25A7EFFB08F08D996631D6728DB6E40746C50D2028B7AD4ED951837A956834BCCC89FD15FDC15ACCFA7596EDB13EBF822A05D028180027FCE29AF3E06865ED6753795922BE1C046655EE067CC436AD096CAD89D8126BD4A7D7C43228AC2F7D8DAB5C804949DA050D35DF3410B5892D1C03FEA58C7107FA66FCA77E9DA1A7CF78E490C572989B87C8F2DAB146A26E54F08D96C5F043C74797594DC06D9DD17C4EFAA810490DBFFB5F160109B65D95A4AD8F33697B9A90281804B19DF569A1D7CF575DF51ACB2D8045FEC48B51EB0040AFC7F89C80204FB4C98D572FF24D06BEA1A43D61598F5D451A9DB3898779C42B6B67C03C95447C8D15BB4E64A29A32678E5532DCBE5D4774913EA9DB2FA720937561BDF37F2FAF255523BABE74DA2CED23427FA81DE84BE15834FDDA6397A3740CE4ABBCC0D9F35A79D02818100B6CB3EA0BD84925263A978549BABBB2FFC5791ABDA645E87761BE3595878E22C2CF95F5D7A547556DAC743E124B7BB862038F1798A25FDFE7942574BD7660D400457D202EC6F700BF357E2EFC5408A1E45D1CFB9FFC3C8C8E7EB79667555015E87EFB6B5A50064AE37AD46916A1A0B9B65599570E76AFFF179A54EEC2C5CB8C7"));

		return (RSAPrivateKey) kf.generatePrivate(pkcsKeySpec);
	}

	public static RSAPublicKey getRsaDkcPublicKey() throws Exception {

		KeyFactory kf = KeyFactory.getInstance("RSA", "BC");

		RSAPublicKeySpec pubKeySpec = new RSAPublicKeySpec(new BigInteger("AC2CC3DEE2CEEDC65DC25D42698AA42A077551B0C80C684FC4BAC967D596F951B5547A405F144D386D74D5F29321C604BA278FDE6F18ED5E6698C7594778C63D51C0CC1E1C29300EBAA66635D2016CE9954FC499F688F6E8EE52194BD35EAB533B7FB6EDCE462B8C411EE4ED1764CFBAC649745CAC70C3C63700FE21BC016A03A587B2189E043F37D91D43CD07C3AD4AAA6AB9882C5621A78E447907E00723D4AF2B0B9BF93202543B05DA6E27EE6C1580CBF2A2D3CEEF23C3BE05C5744DD6E2AB1938AC9B51DB93D6EC8036650024AC6171DA71922DC887EFD167669B6F9DC05641134BB2845207C818CD6BA3F51148558E6D9F4872480DAA47FC86618FDBFD", 16),
				new BigInteger("010001", 16));

		return (RSAPublicKey) kf.generatePublic(pubKeySpec);
	}

	public static RSAPrivateKey getRsaDkcPrivateKey() throws Exception {

		KeyFactory kf = KeyFactory.getInstance("RSA", "BC");
		PKCS8EncodedKeySpec pkcsKeySpec = new PKCS8EncodedKeySpec(
				HexStringConverter.stringToHex("308204BC020100300D06092A864886F70D0101010500048204A6308204A20201000282010100AC2CC3DEE2CEEDC65DC25D42698AA42A077551B0C80C684FC4BAC967D596F951B5547A405F144D386D74D5F29321C604BA278FDE6F18ED5E6698C7594778C63D51C0CC1E1C29300EBAA66635D2016CE9954FC499F688F6E8EE52194BD35EAB533B7FB6EDCE462B8C411EE4ED1764CFBAC649745CAC70C3C63700FE21BC016A03A587B2189E043F37D91D43CD07C3AD4AAA6AB9882C5621A78E447907E00723D4AF2B0B9BF93202543B05DA6E27EE6C1580CBF2A2D3CEEF23C3BE05C5744DD6E2AB1938AC9B51DB93D6EC8036650024AC6171DA71922DC887EFD167669B6F9DC05641134BB2845207C818CD6BA3F51148558E6D9F4872480DAA47FC86618FDBFD0203010001028201000709EC7705F83635CC1AF85390FB8343199B74FBC06DEB6CC96AE6757980AAD02994DACB9B6779D1B2FDDA0A48F412439AB5A7D6CCDD6CC4D5766CFDEC23569D66A47663CBBC6E53C7D32A2E0C9814D306D0E4457413FCDE20721849268AC1FFCCD8A78A98CA7B18C887C20DA44D71859DFA1E48F49EC68E29ACFF76B3182EB486CAFD9DE66BF6FC124400440D4A7A7C1E6EAA88BA51B10A669892544439515B69252213444FBFAFFB312144713583F90BD94B148AC2624F9CFEA9D0D3CA2A411C3E098468BE07AF01103AC22CC535352EDCC515A06439EF4306EEF7475EBD5FB1DB180AB04612B5D51D72779DC493E12A9FA9726E316AE3BDE7BDFEFD21BE9102818100D3B605C1932309BC098DB2BEE60AB69832137C283B88B9D28955B187115CB6E1E9BFF4662B65714286C361D557FA080BD9ECA412B0120AA791850E2C0B20EC143CAAA51B01AF5FB61EE3CF19F9829C4D2904A1B8D81D18788BAE003B6996D9F89E555D54A822DE88B3ABE9BCD4F73C4C0153258A698B9BB3E609BCED202B2CF102818100D0316C0BBF00B3888AECFC9D549F97C89F1B4311F055132AB09CFF1497C3C322BC936A4CB8FDE4DE1E7FE9BE7C1D44B72FA46E77E2AD0C6CC8972621F0C2A9915A16FB19F2A4FFC4B58D1DB63415444DBA6CFCDEB5BB54C9B73318FD405216BF376D67967540522EC377F0FB6481E402E5D12AE1E7DF92218E362F182806CFCD028180360B6F68BD00E2C947BF0E744111570F7F290E36CF0BD633F2AF17849D6007A7A01E4A6B928470E744B3B7D3D883916E45116DC8FF7D7B8ECF4D2213083C3D47E53CC2AD243EFAB5E928CA839CF844A245E852C87712E65E4F79F9C130F13B6F862BD0897DEA78D878D557F3C681DEB8A055F36D64082995411217528935BC6102818074CAD4DEFE0689B0D6A6BDCC10F5FAB32C36A1F88547649A353BCD8922DE4A30C9733555D70D6F7FFFC2284198E4DE70998478083F1C6EF4F3CE7F30D91C8AFDA47971E20B91EE7DCE8F5C94A3412EF11FDD163A65DEB260FAA9EAA1DF9C6D7055CAC52ACD9A08C07D1D630DD4435DC31663B1D7CB394B8411806A08F623641D02818007CC6077F4A9F3B2A8AD7CCCA41902FD51683C0608C628B48CD3857B5E3556770A0DE958027A3A90A7AC3115B98ED6A99A87F3DC965355D2A1A2CC1C82856E38CCA672B88F33EB615F8C11067DDE5F3F47DF1815B00FF1611F9037427A882F7CF05DF01891382679D1E3BB3CDE2116AE27D3B5DE75124455023DAE4B6A03A0E2"));
		return (RSAPrivateKey) kf.generatePrivate(pkcsKeySpec);
	}

	public static RSAPublicKey getRsaUserPublicKey() throws Exception {

		KeyFactory kf = KeyFactory.getInstance("RSA", "BC");

		RSAPublicKeySpec pubKeySpec = new RSAPublicKeySpec(new BigInteger("C8328E724EB868247A057FD907FE6CFF85C1BC12A2F0C2A87384B554F3862D73CAE0F874FD6601DD1FAECE6CF2027316084E51DF90E0D87E02E2860E615D5ABC3E9037C029B7B5A53931E39E612F2C5FD60F6EFDBDFF38171D6BCD818930E394E74055BA2DBEE1DB725A472BB052BB4989317DF7A6951F9AA030CF96416FD252775157408D00DEC3EB223F5C16C902F5F539EF35A204E919F003AC3BEE09CE26EF2FC031BA8765F71B70D27A315BA783604A74BF861995A7B23AE5E2DC9AD4064FE69ED7B5BCAEC7F11AD15A421273FEFDD5DD8519EFDCEE522C242A3FC24A2A5DE0AB58EC81AFBBFC2BDE96D1DD1F230DC69CB5ACFEC6BEBE40BF7344D343A1", 16),
				new BigInteger("010001", 16));

		return (RSAPublicKey) kf.generatePublic(pubKeySpec);
	}
	public static RSAPrivateKey getRsaUserPrivateKey() throws Exception {

		KeyFactory kf = KeyFactory.getInstance("RSA", "BC");
		PKCS8EncodedKeySpec pkcsKeySpec = new PKCS8EncodedKeySpec(
				HexStringConverter.stringToHex("308204BD020100300D06092A864886F70D0101010500048204A7308204A30201000282010100C8328E724EB868247A057FD907FE6CFF85C1BC12A2F0C2A87384B554F3862D73CAE0F874FD6601DD1FAECE6CF2027316084E51DF90E0D87E02E2860E615D5ABC3E9037C029B7B5A53931E39E612F2C5FD60F6EFDBDFF38171D6BCD818930E394E74055BA2DBEE1DB725A472BB052BB4989317DF7A6951F9AA030CF96416FD252775157408D00DEC3EB223F5C16C902F5F539EF35A204E919F003AC3BEE09CE26EF2FC031BA8765F71B70D27A315BA783604A74BF861995A7B23AE5E2DC9AD4064FE69ED7B5BCAEC7F11AD15A421273FEFDD5DD8519EFDCEE522C242A3FC24A2A5DE0AB58EC81AFBBFC2BDE96D1DD1F230DC69CB5ACFEC6BEBE40BF7344D343A102030100010282010038A5316FFF7D271E77163A43FF028AF5CBF372D3351E797DAF5DF3EEEB0EE2AA7A53A88975AF98C467F40EBD7DC69AA8B7C5ED5D9C413A908121763BF869B14445518A2CC9C10CD908B3688BC644D241F5B01D4017B3F0BB7D9C24A44BDCB4F04B74852D2E476DE1A95C08FA40245090F08C3BEFC847368F8A56F54DB70B3C4F8F15C7674271B4CFA7E85F2263A91D138C60DB9DC9A4591CE3BD6F6189E8E3C6055B4D9B9132F62E310C958A53582969F9296A9AB43B01081FB2179CAC3E766A91D097F7B1B2D22E9A0C142EC22C30C3B67BB1F3C53919FB56A78DAEA61C1FCE497AE94047CBB97AF526E18C40909680FD3D0316F6962EE718A321F1DCC258B702818100FFF96783339DB95CEAADF87254FAFB1CE249657FAE9FCA403FC104E1F786BEA7F00E953D6AD9D276F4933284DA2960C950FD7E1280B547A8F641CEF314E194FCC9878B11076EE26F45DC877FE8087CB5DE81DF1EF9D07D95D934F1ADFDD2090AD4294AA1C3BB3627E51FFA5913ADA4C4027F8BDF7E191EC037C432E20419C9A302818100C837B703484BF4D9CA5B8273BCDB04ABA420091036B1C029B3198BE9E145FBA6EF0AB4F9B2B096607C6BB562B395078B6C95C884139BC5639B656FD52C1B880A22D3524F7BA3513963C1AF54E3E66E89AE0755587D80FE8CCE8BF047664FD80F0087910BA23C2427BAD429D50E20B106936B577E2F6EF8B7A25979B3D194D9EB0281810083321B61DDB4BB6AEA459C8F4D0B0E65B17D98EE265C73D7165621E08773A28884BB94B653EBACB9978552615147DFF98EEF3E0CD1B718317B762351E7A3EF2ED944057D06E8485A6BDE29FCDEBA6AE0F45870397A24E81943A8A52E5E67A686CC5315936FB4A67F302A81AFE22C1FC4EEDADCA0020B71FD6717C254A1716E2D0281805C4D3B24DB3E91199A6D877D5DD2469BEE650A689C1E63ED9570B08CD8DACF820CEF8DB1138CCF369A0579B09003A35FC66662F368AAC65BFE36CC50A52DE8106C2FA9E194A91CF7ED224C77413D693635B191C9E2CA060FD9E4AF97EAF5E23040593F27F2D9F0FD13E75D85A826B015CCFE8E6E50E5C2E9BD81AC5696C71D930281802FEFAAE30B836A2AA8F9015BF8D2F965DDB9181C3D06007AA97D6096316593AEE9081452F775862525BD76BB5B3695FAEB8CE3B94F88C45863D00CDDC8E15C5CCDBE833A4E8DB946A44886078CB645740EB4A2539E7BDC4FB91E035E649E7E43F6B4C047272BBF95EE010B011060AE4E67ECA3A20777740524D1E8C2DDFB2BA4"));
		return (RSAPrivateKey) kf.generatePrivate(pkcsKeySpec);
	}

	public static byte[] rsaSign_server(byte[] data) throws Exception {
		KeyFactory kf = KeyFactory.getInstance("RSA", "SC");
		Signature sign = Signature.getInstance("SHA256withRSA", "SC");
		sign.initSign(getRsaDkcPrivateKey());
		sign.update(data);
		byte[] signature = sign.sign();

		return signature;
	}

}